---

- name: prepare database
  ansible.builtin.include_tasks: "{{ icingaweb2_db.type }}/prepare_db.yml"
  when: icingaweb2_db is defined

- name: import database schema
  ansible.builtin.include_tasks: "{{ icingaweb2_db.type }}/import_db.yml"
  when: icingaweb2_db_import_schema | default(False)

- name: add admin to users list 
  ansible.builtin.set_fact:
    icingaweb2_users: '{{ icingaweb2_users + [{"username": "{{ icingaweb2_admin_username }}", "password": "{{ icingaweb2_admin_password }}", "update": "{{ icingaweb2_admin_update | default(false) }}" }]}}'
  when: icingaweb2_admin_username is defined and icingaweb2_admin_password is defined

- name: add icinga web 2 users
  ansible.builtin.include_tasks: "{{ icingaweb2_db.type }}/users_db.yml"
  loop: "{{ icingaweb2_users }}"
  loop_control:
    loop_var: _users
  when: icingaweb2_users is defined
