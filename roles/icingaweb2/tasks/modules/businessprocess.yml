# - name: Module Icinga Business Process Modeling | Install
#   debug:
#     msg: "Module Business Process Modeling installed"

- name: Module Graphite | Ensure config directory
  ansible.builtin.file:
    state: directory
    dest: "{{ icingaweb2_modules_config_dir }}/{{ item.key }}"
    owner: "{{ icingaweb2_httpd_user }}"
    group: "{{ icingaweb2_group }}"
    mode: "2770"

- name: Module Graphite | Ensure processes directory
  ansible.builtin.file:
    state: directory
    dest: "{{ icingaweb2_modules_config_dir }}/{{ item.key }}/processes"
    owner: "{{ icingaweb2_httpd_user }}"
    group: "{{ icingaweb2_group }}"
    mode: "2770"

# - name: Module Business Process Modelling | Ensure Process Directory

- name: Module Business Process Modeling | Manage process files
  ansible.builtin.include_tasks: manage_module_config.yml
  loop: "{{_files}}"
  loop_control:
    loop_var: _file
  when: vars['icingaweb2_modules'][_module][_file] is defined
  vars:
    _module: "{{ item.key }}"
    _files:
      - processes
  

- name: Module Icinga Businessprocess | Copy Process
  ansible.builtin.copy:
    owner: "{{ icingaweb2_httpd_user }}"
    group: "{{ icingaweb2_group }}"
    src: "files/{{ _file.src_path }}"
    dest: "{{ icingaweb2_modules_config_dir }}/{{ item.key }}/processes/{{ _file.name }}"
  when: vars['icingaweb2_modules'][_module]['custom_process_files'] is defined
  loop: "{{ vars['icingaweb2_modules'][_module]['custom_process_files'] }}"
  loop_control:
    loop_var: _file
  vars:
    _module: "{{ item.key }}"