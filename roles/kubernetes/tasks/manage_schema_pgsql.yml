# temporarily disabled, pgsql at the moment is not available for icinga kubernetes

# - name: PgSQL import Kubernetes schema
#   when: kubernetes_database_import_schema| default(False)
#   block:
#     - name: Build pgsql command
#       ansible.builtin.set_fact:
#         _tmp_pgsqlcmd: >-
#           PGPASSWORD="{{ kubernetes_database_password }}"
#           psql
#           "{% if kubernetes_database_host %} host="{{ kubernetes_database_host }}" {%- endif %}
#           {% if kubernetes_database_port is defined %} port={{ kubernetes_database_port }} {%- endif %}
#           user={{ kubernetes_database_user | default('kubernetes') }}
#           dbname={{ kubernetes_database_name | default('kubernetes') }}
#           {% if kubernetes_database_sslmode is defined %} sslmode={{ kubernetes_database_sslmode }} {%- endif %}
#           {% if kubernetes_database_ca is defined %} sslrootcert={{ kubernetes_database_ca }} {%- endif %}
#           {% if kubernetes_database_cert is defined %} sslcert={{ kubernetes_database_cert }} {%- endif %}
#           {% if kubernetes_database_key is defined %} sslkey={{ kubernetes_database_key }} {%- endif %}
#           {% if kubernetes_database_ssl_extra_options is defined %} {{ kubernetes_database_ssl_extra_options }} {%- endif %}"

#     - name: PgSQL check for Kubernetes schema
#       ansible.builtin.shell: >
#         {{ _tmp_pgsqlcmd }}
#         -w -c "select version from kubernetes_schema"
#       failed_when: false
#       changed_when: false
#       check_mode: false
#       register: _db_schema

#     - name: PgSQL import Kubernetes schema
#       ansible.builtin.shell: >
#         {{ _tmp_pgsqlcmd }}
#         -w -f {{ kubernetes_database_schema }}
#       when: _db_schema.rc != 0
#       check_mode: false
#       run_once: true
