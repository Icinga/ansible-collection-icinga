---
- name: Apt - ensure apt keyrings directory
  file:
    state: directory
    path: /etc/apt/keyrings
    owner: root
    group: root
    mode: '0755'

- name: Apt - add repository key
  ansible.builtin.get_url:
    url: "{{ repos_icinga_apt_key }}"
    dest: "{{ repos_icinga_apt_keyring }}"
    owner: root
    group: root
    mode: '0644'
    force: true

- name: Apt - add Icinga repository (stable)
  become: yes
  apt_repository:
    filename: /etc/apt/sources.list.d/icinga
    repo: "{{ repos_icinga_apt_stable_deb }}"
    state: "{{ 'present' if repos_icinga_stable else 'absent' }}"
- name: Apt - add Icinga repository (testing)
  become: yes
  apt_repository:
    filename: /etc/apt/sources.list.d/icinga
    repo: "{{ repos_icinga_apt_testing_deb }}"
    state: "{{ 'present' if repos_icinga_testing else 'absent' }}"
- name: Apt - add Icinga repository (snapshot)
  become: yes
  apt_repository:
    filename: /etc/apt/sources.list.d/icinga
    repo: "{{ repos_icinga_apt_snapshot_deb }}"
    state: "{{ 'present' if repos_icinga_snapshot else 'absent' }}"
